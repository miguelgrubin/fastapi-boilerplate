# Traefik Dynamic Configuration
# Defines middlewares for Authelia authentication
# https://www.authelia.com/integration/proxies/traefik/

http:
  middlewares:
    # Authelia ForwardAuth middleware
    # Used to protect routes that require authentication
    authelia:
      forwardAuth:
        address: 'http://authelia:9091/api/authz/forward-auth'
        trustForwardHeader: true
        authResponseHeaders:
          - 'Remote-User'
          - 'Remote-Groups'
          - 'Remote-Name'
          - 'Remote-Email'

    # Strip /api prefix before forwarding to FastAPI
    strip-api:
      stripPrefix:
        prefixes:
          - '/api'

    # Chain middleware for protected API routes
    api-auth:
      chain:
        middlewares:
          - authelia
          - strip-api

    # Strip /api prefix only (no auth) for public endpoints
    api-public:
      chain:
        middlewares:
          - strip-api
